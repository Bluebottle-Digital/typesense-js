{"version":3,"sources":["Typesense/ApiCall.js"],"names":["APIKEYHEADERNAME","HEALTHY","UNHEALTHY","ApiCall","configuration","_configuration","_apiKey","apiKey","_nodes","JSON","parse","stringify","nodes","_nearestNode","nearestNode","_connectionTimeoutSeconds","connectionTimeoutSeconds","_healthcheckIntervalSeconds","healthcheckIntervalSeconds","_numRetriesPerRequest","numRetries","_retryIntervalSeconds","retryIntervalSeconds","_sendApiKeyAsQueryParam","sendApiKeyAsQueryParam","logger","_initializeMetadataForNodes","_currentNodeIndex","endpoint","queryParameters","abortSignal","performRequest","bodyParameters","additionalHeaders","requestType","validate","requestNumber","Date","now","debug","toUpperCase","numTries","node","_getNextNode","index","aborted","Promise","reject","Error","abortListener","requestOptions","method","url","_uriFor","headers","Object","assign","_defaultHeaders","timeout","maxContentLength","Infinity","maxBodyLength","validateStatus","status","transformResponse","data","transformedData","undefined","startsWith","keys","length","params","cancelToken","axios","CancelToken","source","cancel","addEventListener","token","response","_setNodeHealthcheck","resolve","_customErrorForResponse","message","lastException","warn","code","_timer","removeEventListener","isHealthy","_nodeDueForHealthcheck","map","join","candidateNode","i","isDueForHealthcheck","lastAccessTimestamp","forEach","protocol","host","port","path","defaultHeaders","seconds","setTimeout","messageFromServer","CustomErrorKlass","RequestMalformed","RequestUnauthorized","ObjectNotFound","ObjectAlreadyExists","ObjectUnprocessable","ServerError","HTTPError","errorMessage","trim","customErrror","httpStatus"],"mappings":"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","sourcesContent":["'use strict'\nimport axios from 'axios'\nimport {\n  HTTPError,\n  ObjectAlreadyExists,\n  ObjectNotFound,\n  ObjectUnprocessable,\n  RequestMalformed,\n  RequestUnauthorized,\n  ServerError\n} from './Errors'\n\nconst APIKEYHEADERNAME = 'X-TYPESENSE-API-KEY'\nconst HEALTHY = true\nconst UNHEALTHY = false\n\nexport default class ApiCall {\n  constructor (configuration) {\n    this._configuration = configuration\n\n    this._apiKey = this._configuration.apiKey\n    this._nodes = JSON.parse(JSON.stringify(this._configuration.nodes)) // Make a copy, since we'll be adding additional metadata to the nodes\n    this._nearestNode = JSON.parse(JSON.stringify(this._configuration.nearestNode))\n    this._connectionTimeoutSeconds = this._configuration.connectionTimeoutSeconds\n    this._healthcheckIntervalSeconds = this._configuration.healthcheckIntervalSeconds\n    this._numRetriesPerRequest = this._configuration.numRetries\n    this._retryIntervalSeconds = this._configuration.retryIntervalSeconds\n    this._sendApiKeyAsQueryParam = this._configuration.sendApiKeyAsQueryParam\n\n    this.logger = this._configuration.logger\n\n    this._initializeMetadataForNodes()\n    this._currentNodeIndex = -1\n  }\n\n  get (endpoint, queryParameters = {}, {abortSignal = null} = {}) {\n    return this.performRequest('get', endpoint, {queryParameters, abortSignal})\n  }\n\n  delete (endpoint, queryParameters = {}) {\n    return this.performRequest('delete', endpoint, {queryParameters})\n  }\n\n  post (endpoint, bodyParameters = {}, queryParameters = {}, additionalHeaders = {}) {\n    return this.performRequest('post', endpoint, {queryParameters, bodyParameters, additionalHeaders})\n  }\n\n  put (endpoint, bodyParameters = {}, queryParameters = {}) {\n    return this.performRequest('put', endpoint, {queryParameters, bodyParameters})\n  }\n\n  patch (endpoint, bodyParameters = {}, queryParameters = {}) {\n    return this.performRequest('patch', endpoint, {queryParameters, bodyParameters})\n  }\n\n  async performRequest (requestType, endpoint, {\n    queryParameters = null,\n    bodyParameters = null,\n    additionalHeaders = {},\n    abortSignal = null\n  }) {\n    this\n      ._configuration\n      .validate()\n\n    const requestNumber = Date.now()\n    let lastException\n    this.logger.debug(`Request #${requestNumber}: Performing ${requestType.toUpperCase()} request: ${endpoint}`)\n    for (let numTries = 1; numTries <= this._numRetriesPerRequest + 1; numTries++) {\n      let node = this._getNextNode(requestNumber)\n      this.logger.debug(`Request #${requestNumber}: Attempting ${requestType.toUpperCase()} request Try #${numTries} to Node ${node.index}`)\n\n      if (abortSignal && abortSignal.aborted) {\n        return Promise.reject(new Error('Request aborted by caller.'))\n      }\n      let abortListener\n\n      try {\n        let requestOptions = {\n          method: requestType,\n          url: this._uriFor(endpoint, node),\n          headers: Object.assign({}, this._defaultHeaders(), additionalHeaders),\n          timeout: this._connectionTimeoutSeconds * 1000,\n          maxContentLength: Infinity,\n          maxBodyLength: Infinity,\n          validateStatus: (status) => {\n            /* Override default validateStatus, which only considers 2xx a success.\n                In our case, if the server returns any HTTP code, we will handle it below.\n                We do this to be able to raise custom errors based on response code.\n             */\n            return status > 0\n          },\n          transformResponse: [(data, headers) => {\n            let transformedData = data\n            if (headers !== undefined && typeof data === 'string' && headers['content-type'] && headers['content-type'].startsWith('application/json')) {\n              transformedData = JSON.parse(data)\n            }\n            return transformedData\n          }]\n        }\n\n        if (queryParameters && Object.keys(queryParameters).length !== 0) {\n          requestOptions.params = queryParameters\n        }\n\n        if (this._sendApiKeyAsQueryParam) {\n          requestOptions.params = requestOptions.params || {}\n          requestOptions.params['x-typesense-api-key'] = this._apiKey\n        }\n\n        if (bodyParameters && Object.keys(bodyParameters).length !== 0) {\n          requestOptions.data = bodyParameters\n        }\n\n        // Translate from user-provided AbortController to the Axios request cancel mechanism.\n        if (abortSignal) {\n          const cancelToken = axios.CancelToken\n          const source = cancelToken.source()\n          abortListener = () => source.cancel()\n          abortSignal.addEventListener('abort', abortListener)\n          requestOptions.cancelToken = source.token\n        }\n\n        let response = await axios(requestOptions)\n        if (response.status >= 1 && response.status <= 499) {\n          // Treat any status code > 0 and < 500 to be an indication that node is healthy\n          // We exclude 0 since some clients return 0 when request fails\n          this._setNodeHealthcheck(node, HEALTHY)\n        }\n        this.logger.debug(`Request #${requestNumber}: Request to Node ${node.index} was made. Response Code was ${response.status}.`)\n\n        if (response.status >= 200 && response.status < 300) {\n          // If response is 2xx return a resolved promise\n          return Promise.resolve(response.data)\n        } else if (response.status < 500) {\n          // Next, if response is anything but 5xx, don't retry, return a custom error\n          return Promise.reject(this._customErrorForResponse(response, response.data.message))\n        } else {\n          // Retry all other HTTP errors (HTTPStatus > 500)\n          // This will get caught by the catch block below\n          throw this._customErrorForResponse(response, response.data.message)\n        }\n      } catch (error) {\n        // This block handles retries for HTTPStatus > 500 and network layer issues like connection timeouts\n        this._setNodeHealthcheck(node, UNHEALTHY)\n        lastException = error\n        this.logger.warn(`Request #${requestNumber}: Request to Node ${node.index} failed due to \"${error.code} ${error.message}${error.response == null ? '' : ' - ' + JSON.stringify(error.response.data)}\"`)\n        // this.logger.debug(error.stack)\n        this.logger.warn(`Request #${requestNumber}: Sleeping for ${this._retryIntervalSeconds}s and then retrying request...`)\n        await this._timer(this._retryIntervalSeconds)\n      } finally {\n        if (abortSignal && abortListener) {\n          abortSignal.removeEventListener('abort', abortListener)\n        }\n      }\n    }\n    this.logger.debug(`Request #${requestNumber}: No retries left. Raising last error`)\n    return Promise.reject(lastException)\n  }\n\n  // Attempts to find the next healthy node, looping through the list of nodes once.\n  //   But if no healthy nodes are found, it will just return the next node, even if it's unhealthy\n  //     so we can try the request for good measure, in case that node has become healthy since\n  _getNextNode (requestNumber = 0) {\n    // Check if nearestNode is set and is healthy, if so return it\n    if (this._nearestNode != null) {\n      this.logger.debug(`Request #${requestNumber}: Nodes Health: Node ${this._nearestNode.index} is ${this._nearestNode.isHealthy === true ? 'Healthy' : 'Unhealthy'}`)\n      if (this._nearestNode.isHealthy === true || this._nodeDueForHealthcheck(this._nearestNode, requestNumber)) {\n        this.logger.debug(`Request #${requestNumber}: Updated current node to Node ${this._nearestNode.index}`)\n        return this._nearestNode\n      }\n      this.logger.debug(`Request #${requestNumber}: Falling back to individual nodes`)\n    }\n\n    // Fallback to nodes as usual\n    this.logger.debug(`Request #${requestNumber}: Nodes Health: ${this._nodes.map(node => `Node ${node.index} is ${node.isHealthy === true ? 'Healthy' : 'Unhealthy'}`).join(' || ')}`)\n    let candidateNode\n    for (let i = 0; i <= this._nodes.length; i++) {\n      this._currentNodeIndex = (this._currentNodeIndex + 1) % this._nodes.length\n      candidateNode = this._nodes[this._currentNodeIndex]\n      if (candidateNode.isHealthy === true || this._nodeDueForHealthcheck(candidateNode, requestNumber)) {\n        this.logger.debug(`Request #${requestNumber}: Updated current node to Node ${candidateNode.index}`)\n        return candidateNode\n      }\n    }\n\n    // None of the nodes are marked healthy, but some of them could have become healthy since last health check.\n    //  So we will just return the next node.\n    this.logger.debug(`Request #${requestNumber}: No healthy nodes were found. Returning the next node, Node ${candidateNode.index}`)\n    return candidateNode\n  }\n\n  _nodeDueForHealthcheck (node, requestNumber = 0) {\n    const isDueForHealthcheck = Date.now() - node.lastAccessTimestamp > (this._healthcheckIntervalSeconds * 1000)\n    if (isDueForHealthcheck) {\n      this.logger.debug(`Request #${requestNumber}: Node ${node.index} has exceeded healtcheckIntervalSeconds of ${this._healthcheckIntervalSeconds}. Adding it back into rotation.`)\n    }\n    return isDueForHealthcheck\n  }\n\n  _initializeMetadataForNodes () {\n    if (this._nearestNode != null) {\n      this._nearestNode.index = 'nearestNode'\n      this._setNodeHealthcheck(this._nearestNode, HEALTHY)\n    }\n\n    this._nodes.forEach((node, i) => {\n      node.index = i\n      this._setNodeHealthcheck(node, HEALTHY)\n    })\n  }\n\n  _setNodeHealthcheck (node, isHealthy) {\n    node.isHealthy = isHealthy\n    node.lastAccessTimestamp = Date.now()\n  }\n\n  _uriFor (endpoint, node) {\n    if (node.url != null) {\n      return `${node.url}${endpoint}`\n    }\n    return `${node.protocol}://${node.host}:${node.port}${node.path}${endpoint}`\n  }\n\n  _defaultHeaders () {\n    let defaultHeaders = {}\n    if (!this._sendApiKeyAsQueryParam) {\n      defaultHeaders[APIKEYHEADERNAME] = this._apiKey\n    }\n    defaultHeaders['Content-Type'] = 'application/json'\n    return defaultHeaders\n  }\n\n  async _timer (seconds) {\n    return new Promise(resolve => setTimeout(resolve, seconds * 1000))\n  }\n\n  _customErrorForResponse (response, messageFromServer) {\n    let CustomErrorKlass\n    if (response.status === 400) {\n      CustomErrorKlass = RequestMalformed\n    } else if (response.status === 401) {\n      CustomErrorKlass = RequestUnauthorized\n    } else if (response.status === 404) {\n      CustomErrorKlass = ObjectNotFound\n    } else if (response.status === 409) {\n      CustomErrorKlass = ObjectAlreadyExists\n    } else if (response.status === 422) {\n      CustomErrorKlass = ObjectUnprocessable\n    } else if (response.status >= 500 && response.status <= 599) {\n      CustomErrorKlass = ServerError\n    } else {\n      CustomErrorKlass = HTTPError\n    }\n\n    let errorMessage = `Request failed with HTTP code ${response.status}`\n    if (typeof messageFromServer === 'string' && messageFromServer.trim() !== '') {\n      errorMessage += ` | Server said: ${messageFromServer}`\n    }\n\n    const customErrror = new CustomErrorKlass(errorMessage)\n    customErrror.httpStatus = response.status\n\n    return customErrror\n  }\n}\n"],"file":"ApiCall.js"}